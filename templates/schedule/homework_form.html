{% extends "base.html" %}
{% load django_bootstrap5 static %}

{% block content %}
<h2>{% if object %}Edit{% else %}Create{% endif %} {{ model_name }}</h2>

<!-- Include Flatpickr CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<form method="post">
    {% csrf_token %}
    {% bootstrap_form form %}
    <button type="submit" class="btn btn-success">Save</button>
</form>

<a href="{% url 'schedule:lesson_list' %}" class="btn btn-secondary mt-3">Cancel</a>

{% if object %}
<form method="post" action="{% url 'schedule:homework_delete' object.pk %}" class="btn mt-3">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger"
            onclick="return confirm('Are you sure you want to delete this {{ model_name }}?');">Delete
    </button>
</form>
{% endif %}

<!-- Initialize Flatpickr -->
<script>
    document.addEventListener("DOMContentLoaded", function () {

        const ruLocale = {
            firstDayOfWeek: 1, // Monday
            weekdays: {
                shorthand: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                longhand: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота']
            },
            months: {
                shorthand: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                longhand: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь']
            }
        };

        console.log("Flatpickr initializing...");
        // Initialize Flatpickr for assigned_date
        const assignedDateInput = document.querySelector("#id_assigned_date");
        if (assignedDateInput) {
            const assignedDateValue = "{{ form.assigned_date.value|date:'Y-m-d' }}";
            const defaultAssignedDate = assignedDateValue;
            console.log("Assigned date value:", assignedDateValue);
            console.log("Assigned date default:", defaultAssignedDate);
            console.log("Assigned input value:", assignedDateInput.value);
            flatpickr(assignedDateInput, {
                enableTime: false,
                dateFormat: "Y-m-d",
                firstDayOfWeek: 1, // Monday
                defaultDate: defaultAssignedDate,
                altInput: true,
                altFormat: "F j, Y", // e.g., June 22, 2025
                locale: ruLocale, // Use Russian locale to ensure Monday start
            });
            // console.log("Flatpickr initialized on #id_assigned_date");
        } else {
            // console.error("Input #id_assigned_date not found");
        }

        // Initialize Flatpickr for due_date
        const dueDateInput = document.querySelector("#id_due_date");
        if (dueDateInput) {
            const dueDateValue = "{{ form.due_date.value|date:'Y-m-d' }}";
            const defaultDueDate = dueDateValue;
            console.log("Due date value:", dueDateValue);
            console.log("Due date default:", defaultDueDate);
            console.log("Due input value:", dueDateInput.value);
            flatpickr(dueDateInput, {
                enableTime: false,
                dateFormat: "Y-m-d",
                firstDayOfWeek: 1, // Monday
                defaultDate: defaultDueDate,
                altInput: true,
                altFormat: "F j, Y",
                locale: ruLocale, // Use Russian locale
            });
            console.log("Flatpickr initialized on #id_due_date");
        } else {
            console.error("Input #id_due_date not found");
        }
    });
</script>
{% endblock %}