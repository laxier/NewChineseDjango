{% extends "base.html" %}
{% load django_bootstrap5 static %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>{% if object %}Edit Lesson{% else %}Create Lesson{% endif %}</h2>
    {% if object %}
        <a href="{% url 'schedule:homework_create_from_lesson' object.id %}" class="btn btn-primary">Add Homework for this Lesson</a>
    {% endif %}
</div>

<!-- Include Flatpickr CSS and JS (local files) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<form method="post">
    {% csrf_token %}
    {% bootstrap_form form %}
    <button type="submit" class="btn btn-success">Save</button>
</form>

<a href="{% url 'schedule:lesson_list' %}" class="btn btn-secondary mt-3">Cancel</a>

{% if object %}
    <form method="post" action="{% url 'schedule:lesson_delete' object.pk %}" class="btn mt-3">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this {{ model_name }}?');">Delete</button>
    </form>
{% endif %}

<!-- Initialize Flatpickr -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("Flatpickr initializing...");

                const ruLocale = {
            firstDayOfWeek: 1, // Monday
            weekdays: {
                shorthand: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                longhand: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота']
            },
            months: {
                shorthand: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                longhand: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь']
            }
        };

        // Initialize Flatpickr for date field
        const dateInput = document.querySelector("#id_date");
        if (dateInput) {
            const dateValue = "{{ form.date.value|date:'Y-m-d H:i:s' }}";
            const defaultDate = dateValue;
            console.log("Date value:", dateValue);
            console.log("Date default:", defaultDate);
            console.log("Date input value:", dateInput.value);
            const datePicker = flatpickr(dateInput, {
                enableTime: true,
                dateFormat: "Y-m-d H:i:s",
                time_24hr: true,
                firstDayOfWeek: 1,
                defaultDate: defaultDate,
                altInput: true,
                altFormat: "F j, Y H:i",
                locale: ruLocale
            });
            console.log("Date Flatpickr config:", {
                firstDayOfWeek: datePicker.config.firstDayOfWeek,
                localeFirstDay: datePicker.config.locale.firstDayOfWeek,
                defaultDate: datePicker.config.defaultDate
            });
            console.log("Flatpickr initialized on #id_date");
        } else {
            console.error("Input #id_date not found");
        }
    });
</script>
{% endblock %}